# PROJECT_ID: the project ID of the build.
# $BUILD_ID: the autogenerated ID of the build.
# $REPO_NAME: the source repository name specified by RepoSource.
# $BRANCH_NAME: the branch name specified by RepoSource.
# $TAG_NAME: the tag name specified by RepoSource.
# $REVISION_ID or $COMMIT_SHA: the commit SHA specified by RepoSource or resolved from the specified branch or tag.
# $SHORT_SHA: first 7 characters of $REVISION_ID or $COMMIT_SHA.

steps:
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['config', 'set', 'run/region', 'us-central1']
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['config', 'set', 'run/platform', 'managed']
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['builds', 'submit', '--tag', 'gcr.io/${PROJECT_ID}/services-core-pubsubhandler']
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['run', 'deploy', 'services-core-pubsubhandler', '--image', 'gcr.io/${PROJECT_ID}/services-core-pubsubhandler']

#gcr.io/mikenimer-dam-playground/services-core-pubsubhandler

#gsutil notification create -t gcs-content-monitor -f json gs://mikenimer-dam-playground-content